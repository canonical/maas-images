In the case that a bad image is published it may be quicker to remove it from
the stream than wait for a fixed version to appear at cloud-images.ubuntu.com.
MAAS will import the latest version available from the stream, if a version is
removed the previous version will be automatically retrieved.

Before beginning make sure any import process which imports from
cloud-images.ubuntu.com is disabled so the image isn't recreated.

It is also suggested to create a backup of the stream metadata in
maas-v3-images/streams/v1 so you can use diff to verify only versions you wish
to remove were removed.

Basic usage:
meph2-util remove-version data_d version

data_d - The path to the directory containing the stream you wish to modify.
version - The version of the product you wish to remove.

Example - Remove the version 20191021 from all products
meph2-util remove-version /path/to/stream 20191021

Filters:
You may also add filters to the remove-version command. Only products matching
those filters will have the specified version removed. Filters may be any field
described in the product.

Example - Remove the version 20191021 from all AMD64 Bionic and Xenial
products.
meph2-util remove-version /path/to/stream 20191021 \
    'release~(bionic|xenial)' arch=amd64

Optional Arguments:
 -n, --dry-run - Only show what will be removed, do not modify the stream.
 -u, --no-sign - Do not sign the stream when done. A stream can be signed later
                 with the meph2-util sign command.
 --keyring     - Specify the keyring to use when verifying the stream. Defaults
 to /usr/share/keyrings/ubuntu-cloudimage-keyring.gpg

Clean up:
meph2-util remove-version only modifies the stream metadata. The image files
themselves are left on the filesystem. To automatically remove them run the
following commands

Find all orphaned files and write the list to /tmp/orphans:
meph2-util find-orphans /tmp/orphans /path/to/stream

Delete all orphaned files:
meph2-util reap-orphans /tmp/orphans /path/to/stream --older 0

Remove orphan file:
rm /tmp/orphans
